<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script> 
	$(document).ready(function(){
		listTasks();

		$("#newForm").submit(function(event){
			event.preventDefault();   
			$.post("process.php?action=new", $(this).serialize(), function(data){
				addTask(data[0]); 
				//console.log(data[0]);
			});
			$("#description").val('');
			$("#priority").val('');
		}); 

		$("input[name='sort']").click(function(event){
			if($('input[name=sort]:checked').val() == "byPriority")
			{
				$.get("process.php?sortby=priority", function(data){
					$("#taskList tr").remove();
					$("#taskList").append("<tr><th>CheckBox</th><th>Description</th><th>Priority</th><th>Date Created</th><th>Date Completed</th></tr>");
					for(var i = 0; i < data.length; i++)
					{ 
						addTask(data[i]);
					}
				});
			}
			else if($('input[name=sort]:checked').val() == "byDate")
			{
				$.get("process.php?sortby=datecreated", function(data){
					$("#taskList tr").remove();
					$("#taskList").append("<tr><th>CheckBox</th><th>Description</th><th>Priority</th><th>Date Created</th><th>Date Completed</th></tr>");
					for(var i = 0; i < data.length; i++)
					{ 
						addTask(data[i]);
					}
				});
			}
		});

		$("input[name='display']").click(function(event){
			if($('input[name=display]:checked').val() == 'incomplete')
			{
				$.get("process.php?includecompleted=false", function(data){
								$("#taskList tr").remove();
								$("#taskList").append("<tr><th>CheckBox</th><th>Description</th><th>Priority</th><th>Date Created</th><th>Date Completed</th></tr>");
								for (var i= 0; i <data.length; i++) 
								{ 
									addTask(data[i]);
								}; 
				});
			}
			else if($('input[name=display]:checked').val() == 'all')
			{
				$.get("process.php?includecompleted=true", function(data){
								$("#taskList tr").remove();
								$("#taskList").append("<tr><th>CheckBox</th><th>Description</th><th>Priority</th><th>Date Created</th><th>Date Completed</th></tr>");
								for (var i= 0; i <data.length; i++) 
								{ 
									addTask(data[i]);
								}; 
				});
			}
		});

		$("#complete").click(function(event){
			event.preventDefault();
			var checkNum = $('input[name="doSth[]"]:checked').length;
			if(!checkNum)
			{
				alert("Please select at least one task!");
			}
			else
			{
				var checkVal = [];
				$("input[type=checkbox]:checked").each(function(i){
					checkVal[i] = $(this).attr('id');
				}); 
				var data = JSON.stringify(checkVal);
			}
		});

		$("#delete").click(function(event){
			event.preventDefault(); 
			var checkNum = $('input[name="doSth[]"]:checked').length;
			if(!checkNum)
			{
				alert("Please select at least one task!");
			}
			else
			{
				var checkVal = [];
				$("input[type=checkbox]:checked").each(function(i){
					checkVal[i] = 'id=' + $(this).attr('id');
				});
				alert(checkVal);
				/*$.get("process.php?action=delete", function(data){
					console.log(data);
				});*/
			}
		});
	});

	function addTask(data)
	{
		$("#taskList").append("<tr><td><input type='CheckBox' name='doSth[]' id='" + data.id + "' /></td><td>" + data.description + "</td><td>" + data.priority +"</td><td>" + data.dateCreated +"</td><td>" + data.dateCompleted + "</td></tr>");
	}

	function listTasks()
	{
		$.get("process.php?action=list", function(data){
			for(var i = 0; i < data.length; i++)
			{
				addTask(data[i]);
			}
		});
	}
</script>
<head>
<body>
<h1>My task list</h1>
	<table id="whatDisplay" border="1" border-collapse="collapse">
		<th>Task to Display</th>
		<tr><td><input type="radio" value="incomplete" name="display">Show incomplete only</td></tr>
		<tr><td><input type="radio" value="all" name="display">Show all</td></tr>
	</table>
<br/>
	<table id="howDisplay"  border="1" border-collapse="collapse">
		<th>Sort Order</th>
		<tr><td><input type="radio" value="byDate" name="sort">Sort by date created</td></tr>
		<tr><td><input type="radio" value="byPriority" name="sort">Sort by priority</td></tr>
	</table>
<br/> 
	<table id="taskList" style="border: 1px solid black" border-collapse="collapse">
		<tr>
			<th>CheckBox</th>
			<th>Description</th>
			<th>Priority</th>
			<th>Date Created</th>
			<th>Date Completed</th>
		</tr>
	</table>
	<br/>
	<input type="submit" name="complete" id="complete" value="Mark as Complete" />
	<input type="submit" name="delete" id="delete" value="Delete task" />
<br/>

<form id="newForm" autocomplete="off" >
	<h3>Add a new task</h3>
	Task: <input type="text" id="description" name="description"  required /><br/><br/>
	Priority: <select id="priority" name="priority"  required>
		<option disabled selected value="" ></option>
		<option  value="1">1</option>
		<option  value="2">2</option>
		<option  value="3">3</option>
		<option  value="4">4</option>
		<option  value="5">5</option>
	</select><br/><br/>
	<input type="submit" name="add" value="New Task">
</form>
</body>
